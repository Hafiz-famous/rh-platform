{% extends "base.html" %}
{% block title %}{{ 'Nouveau' if not user else 'Modifier' }} utilisateur{% endblock %}

{% block content %}
<div class="d-flex align-items-center justify-content-between mb-3">
  <h1 class="page-title mb-0">{{ 'Nouveau' if not user else 'Modifier' }} utilisateur</h1>
  <a class="btn btn-outline-secondary" href="{{ url_for('admin_users.list_users') }}">
    <i class="bi bi-arrow-left"></i> Retour
  </a>
</div>

<form method="post" class="card card-soft p-3">
  <div class="row g-3">
    <div class="col-md-6">
      <label class="form-label">Email</label>
      <input name="email" type="email" class="form-control" value="{{ user.email if user }}"
             {% if user %}readonly{% endif %} required>
      {% if user %}<div class="form-text">L'email ne peut pas être modifié.</div>{% endif %}
    </div>
    <div class="col-md-3">
      <label class="form-label">Prénom</label>
      <input name="first_name" class="form-control" value="{{ user.first_name if user }}">
    </div>
    <div class="col-md-3">
      <label class="form-label">Nom</label>
      <input name="last_name" class="form-control" value="{{ user.last_name if user }}">
    </div>

    <div class="col-md-4">
      <label class="form-label">Rôle</label>
      <select name="role" class="form-select">
        {% for r in Role %}
          <option value="{{ r.name }}"
            {% if user and user.role==r %}selected{% endif %}>
            {{ r.name }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div class="col-md-4">
      <label class="form-label">Département</label>
      <select name="department_id" class="form-select">
        <option value="">— Aucun —</option>
        {% for d in departments %}
          <option value="{{ d.id }}" {% if user and user.department_id==d.id %}selected{% endif %}>
            {{ d.name }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div class="col-md-4">
      <label class="form-label">Taux horaire</label>
      <input name="hourly_rate" type="number" step="0.01" min="0" class="form-control"
             value="{{ '%.2f'|format(user.hourly_rate) if user and user.hourly_rate is not none }}">
    </div>

    <div class="col-md-6">
      <label class="form-label">{{ 'Mot de passe (laisser vide pour ne pas changer)' if user else 'Mot de passe' }}</label>
      <input name="password" type="password" class="form-control" {% if not user %}required{% endif %}>
    </div>
  </div>

  <div class="mt-3 d-flex gap-2">
    <button class="btn btn-primary" type="submit">
      <i class="bi bi-check2-circle me-1"></i> Enregistrer
    </button>
    <a class="btn btn-outline-secondary" href="{{ url_for('admin_users.list_users') }}">Annuler</a>
  </div>
</form>
{% endblock %}
